@model List<AromasWeb.Abstracciones.ModeloUI.SolicitudVacaciones>

@{
    ViewBag.Title = "Mis Solicitudes de Vacaciones";
}

<!-- Hero Section -->
<section class="hero" style="min-height: 40vh; padding: 8rem 0 4rem;">
    <div class="hero-bg-overlay"></div>
    <div class="hero-leaves"></div>
    <div class="container hero-container" style="display: block;">
        <div class="hero-content" data-aos="fade-up" style="text-align: center;">
            <span class="hero-badge">
                <i class="fas fa-umbrella-beach"></i>
                Mis Vacaciones
            </span>
            <h1 class="hero-title" style="font-size: 3.5rem;">
                Consulta tus solicitudes de vacaciones y saldo disponible
            </h1>

            <!-- Info rápida del empleado -->
            <div style="display: flex; justify-content: center; gap: 3rem; flex-wrap: wrap; margin-top: 2rem; margin-bottom: 3rem; color: black;">
                <div>
                    <i class="fas fa-briefcase" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; opacity: 0.9;"></i>
                    <strong style="display: block; font-size: 1.1rem;">@ViewBag.CargoEmpleado</strong>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Cargo</span>
                </div>
                <div>
                    <i class="fas fa-calendar-alt" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; opacity: 0.9;"></i>
                    <strong style="display: block; font-size: 1.1rem;">@ViewBag.MesesTrabajados meses</strong>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Antigüedad</span>
                </div>
                <div>
                    <i class="fas fa-calendar-check" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; opacity: 0.9;"></i>
                    <strong style="display: block; font-size: 1.1rem;">@ViewBag.DiasDisponibles días</strong>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Disponibles</span>
                </div>
            </div>
        </div>
    </div>
    <div class="scroll-indicator">
        <div class="mouse">
            <div class="wheel"></div>
        </div>
    </div>
</section>

<!-- Content Section -->
<section style="padding: 4rem 0; background: var(--cream);">
    <div class="container" style="max-width: 1200px;">

        <!-- Mensajes TempData -->
        @if (TempData["Mensaje"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-bottom: 2rem; border-radius: 15px;">
                <i class="fas fa-check-circle"></i> @TempData["Mensaje"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert" style="margin-bottom: 2rem; border-radius: 15px;">
                <i class="fas fa-exclamation-triangle"></i> @TempData["Error"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <!-- Saldo de Vacaciones -->
        <div class="feature-card" style="background: white; padding: 3rem; margin-bottom: 3rem; position: relative; overflow: hidden; border-left: 5px solid var(--gold);" data-aos="zoom-in">
            <div style="position: relative; z-index: 1;">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                    <div style="width: 70px; height: 70px; background: var(--gold); border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md);">
                        <i class="fas fa-calendar-check" style="font-size: 2rem; color: white;"></i>
                    </div>
                    <div>
                        <p style="margin: 0; color: var(--charcoal); opacity: 0.7; font-size: 0.95rem;">Tu Saldo de Vacaciones</p>
                        <h2 style="margin: 0; font-size: 3rem; font-weight: 700; font-family: var(--font-primary); color: var(--dark-green);">
                            @ViewBag.DiasDisponibles<span style="font-size: 1.5rem; opacity: 0.7; color: var(--charcoal);"> días</span>
                        </h2>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; background: var(--cream); padding: 2rem; border-radius: 20px;">
                    <div>
                        <p style="margin: 0 0 0.5rem; color: var(--charcoal); opacity: 0.7; font-size: 0.9rem;">
                            <i class="fas fa-calendar-plus" style="color: var(--olive-green);"></i> Días Acumulados
                        </p>
                        <strong style="font-size: 1.1rem; color: var(--dark-green);">@ViewBag.DiasAcumulados días</strong>
                    </div>
                    <div>
                        <p style="margin: 0 0 0.5rem; color: var(--charcoal); opacity: 0.7; font-size: 0.9rem;">
                            <i class="fas fa-umbrella-beach" style="color: var(--olive-green);"></i> Días Tomados
                        </p>
                        <strong style="font-size: 1.1rem; color: var(--dark-green);">@ViewBag.DiasTomados días</strong>
                    </div>
                    <div>
                        <p style="margin: 0 0 0.5rem; color: var(--charcoal); opacity: 0.7; font-size: 0.9rem;">
                            <i class="fas fa-file-alt" style="color: var(--olive-green);"></i> Total Solicitudes
                        </p>
                        <strong style="font-size: 1.1rem; color: var(--dark-green);">@Model.Count</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estadísticas de solicitudes -->
        <div class="features-grid" style="margin-bottom: 3rem;" data-aos="fade-up">
            <div class="feature-card" style="background: white;" data-aos="fade-up" data-aos-delay="0">
                <div class="feature-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">@Model.Count(s => s.Estado == "Pendiente")</h3>
                <p style="margin: 0.5rem 0;">Pendientes</p>
            </div>
            <div class="feature-card" style="background: white;" data-aos="fade-up" data-aos-delay="100">
                <div class="feature-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">@Model.Count(s => s.Estado == "Aprobada")</h3>
                <p style="margin: 0.5rem 0;">Aprobadas</p>
            </div>
            <div class="feature-card" style="background: white;" data-aos="fade-up" data-aos-delay="200">
                <div class="feature-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">@Model.Count(s => s.Estado == "Rechazada")</h3>
                <p style="margin: 0.5rem 0;">Rechazadas</p>
            </div>
        </div>

        <!-- Botón Nueva Solicitud -->
        <div style="display: flex; gap: 1rem; margin-bottom: 3rem; flex-wrap: wrap;" data-aos="fade-up">
            <a href="@Url.Action("SolicitarVacacionesEmpleado", "SolicitudVacaciones")" class="btn btn-primary btn-3d">
                <span><i class="fas fa-plus"></i> Nueva Solicitud de Vacaciones</span>
            </a>
        </div>

        <!-- Timeline de Solicitudes -->
        <div class="timeline-container" data-aos="fade-up">
            <div class="timeline-header">
                <h2><i class="fas fa-clock" style="color: var(--gold); margin-right: 0.7rem;"></i> Historial de Mis Solicitudes</h2>
                <p>Aquí puedes ver el estado de todas tus solicitudes de vacaciones</p>
            </div>

            @if (Model.Any())
            {
                <div id="historial-solicitudes-timeline">
                    @{
                        int numeroSolicitud = Model.Count;
                    }

                    @foreach (var solicitud in Model)
                    {
                        var estadoColor = solicitud.Estado switch
                        {
                            "Aprobada" => "var(--green)",
                            "Rechazada" => "var(--red)",
                            "Pendiente" => "var(--yellow)",
                            "Cancelada" => "var(--charcoal)",
                            _ => "var(--charcoal)"
                        };
                        var iconoEstado = solicitud.Estado switch
                        {
                            "Aprobada" => "fa-check-circle",
                            "Rechazada" => "fa-times-circle",
                            "Pendiente" => "fa-clock",
                            "Cancelada" => "fa-ban",
                            _ => "fa-question-circle"
                        };
                        var badgeClass = solicitud.Estado switch
                        {
                            "Aprobada" => "approved",
                            "Rechazada" => "rejected",
                            "Pendiente" => "warning",
                            "Cancelada" => "",
                            _ => ""
                        };
                        var esActual = solicitud.Estado == "Pendiente" && solicitud == Model.FirstOrDefault(s => s.Estado == "Pendiente");

                        <div class="timeline-card">
                            <div class="timeline-card-content">
                                <div class="timeline-card-header">
                                    <div class="timeline-date-wrapper">
                                        <div class="timeline-date-badge">
                                            <span class="timeline-date-day">@solicitud.FechaInicio.Day</span>
                                            <span class="timeline-date-month">@solicitud.FechaInicio.ToString("MMM")</span>
                                        </div>
                                        <div class="timeline-date-info">
                                            <h3>Solicitud #@numeroSolicitud</h3>
                                            <p>@solicitud.PeriodoVacaciones</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                                        <span class="timeline-status-badge @badgeClass">
                                            <i class="fas @iconoEstado"></i> @solicitud.Estado
                                        </span>
                                        @if (esActual)
                                        {
                                            <span class="timeline-status-badge warning">
                                                <i class="fas fa-hourglass-half"></i> En revisión
                                            </span>
                                        }
                                    </div>
                                </div>

                                <div class="timeline-details-grid">
                                    <div class="timeline-detail-item">
                                        <p class="timeline-detail-label">
                                            <i class="fas fa-clock" style="color: var(--gold-bright);"></i> Días Solicitados
                                        </p>
                                        <p class="timeline-detail-value">@solicitud.DiasSolicitados días</p>
                                    </div>
                                    <div class="timeline-detail-item">
                                        <p class="timeline-detail-label">
                                            <i class="fas fa-calendar-plus" style="color: var(--gold-bright);"></i> Días calendario
                                        </p>
                                        <p class="timeline-detail-value">@solicitud.DuracionCalendario días</p>
                                    </div>
                                    <div class="timeline-detail-item">
                                        <p class="timeline-detail-label">
                                            <i class="fas fa-paper-plane" style="color: var(--olive-green);"></i> Solicitado
                                        </p>
                                        <p class="timeline-detail-value small">@solicitud.FechaSolicitudFormateada</p>
                                    </div>
                                    @if (solicitud.FechaRespuesta.HasValue)
                                    {
                                        <div class="timeline-detail-item">
                                            <p class="timeline-detail-label">
                                                <i class="fas fa-reply" style="color: var(--olive-green);"></i> Respondido
                                            </p>
                                            <p class="timeline-detail-value small">@solicitud.FechaRespuestaFormateada (@solicitud.TiempoRespuesta)</p>
                                        </div>
                                    }
                                </div>

                                @if (solicitud.Estado == "Pendiente")
                                {
                                    <div class="timeline-info-message">
                                        <p>
                                            <i class="fas fa-info-circle" style="color: var(--gold-bright);"></i>
                                            Tu solicitud está en revisión. Recibirás una respuesta pronto.
                                        </p>
                                    </div>
                                }
                                else if (solicitud.Estado == "Aprobada")
                                {
                                    <div style="background: rgba(39, 174, 96, 0.08); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--green);">
                                        <p style="margin: 0; color: var(--dark-green); display: flex; align-items: center; gap: 0.7rem;">
                                            <i class="fas fa-check-circle" style="color: var(--green); font-size: 1.2rem;"></i>
                                            <span><strong>¡Aprobada!</strong> Disfruta tus vacaciones del @solicitud.FechaInicioFormateada al @solicitud.FechaFinFormateada</span>
                                        </p>
                                    </div>
                                }
                                else if (solicitud.Estado == "Rechazada")
                                {
                                    <div style="background: rgba(231, 76, 60, 0.08); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--red);">
                                        <p style="margin: 0; color: var(--dark-green); display: flex; align-items: center; gap: 0.7rem;">
                                            <i class="fas fa-times-circle" style="color: var(--red); font-size: 1.2rem;"></i>
                                            <span>Tu solicitud fue rechazada. Consulta con Recursos Humanos para más información.</span>
                                        </p>
                                    </div>
                                }
                                else if (solicitud.Estado == "Cancelada")
                                {
                                    <div style="background: rgba(43,43,43,0.05); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--charcoal);">
                                        <p style="margin: 0; color: var(--charcoal); display: flex; align-items: center; gap: 0.7rem; opacity: 0.7;">
                                            <i class="fas fa-ban" style="font-size: 1.2rem;"></i>
                                            <span>Esta solicitud fue cancelada.</span>
                                        </p>
                                    </div>
                                }

                                @if (solicitud.Estado == "Pendiente")
                                {
                                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--cream); display: flex; justify-content: flex-end; gap: 0.5rem;">
                                        <a href="@Url.Action("EditarSolicitud", "SolicitudVacaciones", new { id = solicitud.IdSolicitud })"
                                           class="btn btn-secondary"
                                           style="font-size: 0.85rem; padding: 0.4rem 1.2rem; background: var(--olive-green); color: white; border: none;">
                                            <span><i class="fas fa-edit"></i> Editar Solicitud</span>
                                        </a>

                                        <button type="button"
                                                class="btn btn-secondary btn-cancelar-solicitud"
                                                style="font-size: 0.85rem; padding: 0.4rem 1.2rem;"
                                                data-bs-toggle="modal"
                                                data-bs-target="#modalCancelarSolicitud"
                                                data-id="@solicitud.IdSolicitud"
                                                data-empleado="@solicitud.NombreEmpleado"
                                                data-periodo="@solicitud.PeriodoVacaciones"
                                                data-dias-solicitados="@solicitud.DiasSolicitados">
                                            <span><i class="fas fa-ban"></i> Cancelar Solicitud</span>
                                        </button>
                                    </div>
                                }

                                <div style="margin-top: 1rem; ...">
                                    <i class="fas fa-calendar-plus"></i> Registrado el @solicitud.FechaSolicitudFormateada
                                </div>
                            </div>
                        </div>
                        numeroSolicitud--;
                    }
                </div>

                <!-- Footer de paginación -->
                <div class="admin-table-footer" style="border-radius: 0 0 15px 15px; margin-top: 1rem;">
                    <div class="admin-table-footer-text">
                        Mostrando <strong id="startCard">0</strong> - <strong id="endCard">0</strong> de <strong id="totalCards">0</strong> registros
                    </div>
                    <div class="pagination-buttons">
                        <button id="btnAnteriorCards" class="pagination-btn">
                            <i class="fas fa-chevron-left"></i> Anterior
                        </button>
                        <button id="btnSiguienteCards" class="pagination-btn">
                            Siguiente <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            }
            else
            {
                <div style="text-align: center; padding: 3rem; color: var(--charcoal); opacity: 0.7;">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                    <p style="margin: 0; font-size: 1.1rem; font-weight: 600;">No tienes solicitudes registradas</p>
                    <p style="margin: 0.5rem 0 1.5rem; font-size: 0.95rem;">Aún no has solicitado vacaciones</p>
                    <a href="@Url.Action("SolicitarVacacionesEmpleado", "SolicitudVacaciones")" class="btn btn-primary">
                        <span><i class="fas fa-plus"></i> Hacer mi Primera Solicitud</span>
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<partial name="_ModalCancelarSolicitud" />

@section Scripts {
    <script src="~/js/solicitudvacaciones.js"></script>
}