@model List<AromasWeb.Abstracciones.ModeloUI.HistorialTarifa>

@{
    ViewBag.Title = "Historial de Tarifas del Empleado";
    var empleado = (AromasWeb.Abstracciones.ModeloUI.Empleado)ViewBag.Empleado;
    var tarifaActual = Model.FirstOrDefault(t => t.EstadoVigencia == "Vigente");
    var primeraTarifa = Model.OrderBy(t => t.FechaInicio).FirstOrDefault();
    var crecimiento = 0m;
    if (primeraTarifa != null && tarifaActual != null && primeraTarifa.TarifaHora > 0)
    {
        crecimiento = ((tarifaActual.TarifaHora - primeraTarifa.TarifaHora) / primeraTarifa.TarifaHora) * 100;
    }
}

<!-- Hero Section -->
<section class="hero" style="min-height: 40vh; padding: 8rem 0 4rem;">
    <div class="hero-bg-overlay"></div>
    <div class="hero-leaves"></div>
    <div class="container hero-container" style="display: block;">
        <div class="hero-content" data-aos="fade-up" style="text-align: center;">
            <span class="hero-badge">
                <i class="fas fa-user-clock"></i>
                Historial Personal
            </span>
            <h1 class="hero-title" style="font-size: 3.5rem;">
                Historial de <span class="hero-title-accent">Tarifas</span>
            </h1>
            <p class="hero-subtitle">
                @empleado.Nombre @empleado.Apellidos • @empleado.Cargo
            </p>

            <!-- Info rápida del empleado -->
            <div style="display: flex; justify-content: center; gap: 3rem; flex-wrap: wrap; margin-top: 2rem; margin-bottom: 3rem; color: var(--charcoal);">
                <div>
                    <i class="fas fa-briefcase" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; opacity: 0.9;"></i>
                    <strong style="display: block; font-size: 1.1rem;">@empleado.Cargo</strong>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Puesto Actual</span>
                </div>
                <div>
                    <i class="fas fa-id-card" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; opacity: 0.9;"></i>
                    <strong style="display: block; font-size: 1.1rem;">@empleado.Identificacion</strong>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Identificación</span>
                </div>
                <div>
                    <i class="fas fa-calendar-alt" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; opacity: 0.9;"></i>
                    <strong style="display: block; font-size: 1.1rem;">@empleado.AnosTrabajados</strong>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Antigüedad</span>
                </div>
                <div>
                    <i class="fas fa-calendar-check" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block; opacity: 0.9;"></i>
                    <strong style="display: block; font-size: 1.1rem;">@empleado.FechaContratacionFormateada</strong>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Fecha Contratación</span>
                </div>
            </div>
        </div>
    </div>
    <div class="scroll-indicator">
        <div class="mouse">
            <div class="wheel"></div>
        </div>
    </div>
</section>

<!-- Content Section -->
<section style="padding: 4rem 0; background: var(--cream);">
    <div class="container" style="max-width: 1200px;">

        <!-- Estadísticas de Tarifas -->
        <div class="features-grid" style="margin-bottom: 3rem;" data-aos="fade-up">
            <div class="feature-card" style="background: white;" data-aos="fade-up" data-aos-delay="0">
                <div class="feature-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">
                    @if (tarifaActual != null)
                    {
                        <text>₡@tarifaActual.TarifaHora.ToString("N2")</text>
                    }
                    else
                    {
                        <text>Sin tarifa</text>
                    }
                </h3>
                <p style="margin: 0.5rem 0;">Tarifa Actual por Hora</p>
            </div>

            <div class="feature-card" style="background: white;" data-aos="fade-up" data-aos-delay="100">
                <div class="feature-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">
                    @if (tarifaActual != null)
                    {
                        <text>₡@tarifaActual.SalarioMensualEstimado.ToString("N0")</text>
                    }
                    else
                    {
                        <text>₡0</text>
                    }
                </h3>
                <p style="margin: 0.5rem 0;">Salario Mensual Estimado</p>
            </div>

            <div class="feature-card" style="background: white;" data-aos="fade-up" data-aos-delay="200">
                <div class="feature-icon">
                    <i class="fas fa-history"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">@Model.Count</h3>
                <p style="margin: 0.5rem 0;">Cambios de Tarifa</p>
            </div>

            <div class="feature-card" style="background: white;" data-aos="fade-up" data-aos-delay="300">
                <div class="feature-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">@crecimiento.ToString("N1")%</h3>
                <p style="margin: 0.5rem 0;">Crecimiento Salarial</p>
            </div>
        </div>

        <!-- Botones de Acción -->
        <div style="display: flex; gap: 1rem; margin-bottom: 3rem; flex-wrap: wrap;" data-aos="fade-up">
            <a href="@Url.Action("CrearTarifa", "HistorialTarifa", new { idEmpleado = empleado.IdEmpleado })" class="btn btn-primary btn-3d">
                <span><i class="fas fa-plus"></i> Registrar Nueva Tarifa</span>
            </a>
            <a href="@Url.Action("ListadoTarifas", "HistorialTarifa")" class="btn btn-secondary">
                <span><i class="fas fa-arrow-left"></i> Volver al Listado</span>
            </a>
            <button onclick="window.print()" class="btn" style="background: var(--olive-green); color: white; border: none; margin-left: auto;">
                <span><i class="fas fa-print"></i> Imprimir Historial</span>
            </button>
        </div>

        <!-- Timeline de Tarifas -->
        <div class="timeline-container" data-aos="fade-up">
            @if (Model != null && Model.Any())
            {
                <div class="timeline-header">
                    <h2>
                        <i class="fas fa-clock" style="color: var(--gold);"></i>
                        Línea de Tiempo de Tarifas
                    </h2>
                    <p>Evolución salarial completa del empleado</p>
                </div>

                <div id="historial-tarifa-timeline">
                    @foreach (var tarifa in Model.OrderByDescending(t => t.FechaInicio))
                    {
                        var badgeClass = tarifa.EstadoVigencia switch
                        {
                            "Vigente" => "complete",
                            "Vencida" => "rejected",
                            "Futura" => "warning",
                            _ => ""
                        };
                        var iconoEstado = tarifa.EstadoVigencia switch
                        {
                            "Vigente" => "fa-check-circle",
                            "Vencida" => "fa-times-circle",
                            "Futura" => "fa-calendar",
                            _ => "fa-question-circle"
                        };

                        <div class="timeline-card">
                            <div class="timeline-card-content">
                                <div class="timeline-card-header">
                                    <!-- Fecha y referencia -->
                                    <div class="timeline-date-wrapper">
                                        <div class="timeline-date-badge">
                                            <div class="timeline-date-day">@tarifa.FechaInicio.ToString("dd")</div>
                                            <div class="timeline-date-month">@tarifa.FechaInicio.ToString("MMM", new System.Globalization.CultureInfo("es-ES"))</div>
                                        </div>
                                        <div class="timeline-date-info">
                                            <h3>₡@tarifa.TarifaHora.ToString("N2") / hora</h3>
                                            <p>Registro #@tarifa.IdHistorialTarifa</p>
                                        </div>
                                    </div>

                                    <!-- Estado -->
                                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                                        <span class="timeline-status-badge @badgeClass">
                                            <i class="fas @iconoEstado"></i> @tarifa.EstadoVigencia
                                        </span>
                                        @if (tarifa.CumpleSalarioMinimo)
                                        {
                                            <span class="timeline-status-badge complete" style="font-size: 0.75rem;">
                                                <i class="fas fa-shield-alt"></i> Cumple mínimo
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="timeline-status-badge rejected" style="font-size: 0.75rem;">
                                                <i class="fas fa-exclamation-triangle"></i> Bajo mínimo
                                            </span>
                                        }
                                    </div>
                                </div>

                                <!-- Detalles de vigencia -->
                                <div class="timeline-details-grid">
                                    <div class="timeline-detail-item">
                                        <label class="timeline-detail-label">
                                            <i class="fas fa-play" style="color: var(--green);"></i> Inicio
                                        </label>
                                        <p class="timeline-detail-value">@tarifa.FechaInicioFormateada</p>
                                    </div>

                                    <div class="timeline-detail-item">
                                        <label class="timeline-detail-label">
                                            <i class="fas fa-stop" style="color: var(--red);"></i> Fin
                                        </label>
                                        <p class="timeline-detail-value @(tarifa.FechaFin.HasValue ? "" : "pending")">
                                            @(tarifa.FechaFin.HasValue? tarifa.FechaFinFormateada: "Indefinido")
                                        </p>
                                    </div>

                                    <div class="timeline-detail-item">
                                        <label class="timeline-detail-label">
                                            <i class="fas fa-hourglass-half" style="color: var(--gold-bright);"></i> Vigencia
                                        </label>
                                        <p class="timeline-detail-value">@tarifa.DiasVigencia días</p>
                                    </div>
                                </div>

                                <!-- Estadísticas salariales -->
                                <div class="timeline-stats">
                                    <div class="timeline-stats-grid">
                                        <div class="timeline-stat-item">
                                            <p class="timeline-stat-label">
                                                <i class="fas fa-dollar-sign"></i> Tarifa por Hora
                                            </p>
                                            <strong class="timeline-stat-value">
                                                ₡@tarifa.TarifaHora.ToString("N2")
                                            </strong>
                                        </div>
                                        <div class="timeline-stat-item">
                                            <p class="timeline-stat-label">
                                                <i class="fas fa-wallet"></i> Salario Mensual
                                            </p>
                                            <strong class="timeline-stat-value extra">
                                                ₡@tarifa.SalarioMensualEstimado.ToString("N2")
                                            </strong>
                                        </div>
                                        <div class="timeline-stat-item">
                                            <p class="timeline-stat-label">
                                                <i class="fas fa-calendar-plus"></i> Registrado
                                            </p>
                                            <strong class="timeline-stat-value total" style="font-size: 0.95rem;">
                                                @tarifa.FechaRegistroFormateada
                                            </strong>
                                        </div>
                                    </div>
                                </div>

                                <!-- Motivo -->
                                <div class="timeline-info-message">
                                    <p>
                                        <i class="fas fa-comment" style="color: var(--gold);"></i>
                                        <span><strong>Motivo:</strong> @tarifa.Motivo</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Footer de paginación -->
                <div class="timeline-pagination-footer">
                    <div class="timeline-pagination-info">
                        Mostrando <strong id="startCard">0</strong> - <strong id="endCard">0</strong> de <strong id="totalCards">0</strong> registros
                    </div>
                    <div class="timeline-pagination-buttons">
                        <button id="btnAnteriorCards" class="timeline-pagination-btn">
                            <i class="fas fa-chevron-left"></i> Anterior
                        </button>
                        <button id="btnSiguienteCards" class="timeline-pagination-btn">
                            Siguiente <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            }
            else
            {
                <div class="feature-card timeline-empty">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <h5>No hay registros de tarifas</h5>
                    <p>Este empleado aún no tiene tarifas registradas.</p>
                    <a href="@Url.Action("CrearTarifa", "HistorialTarifa", new { idEmpleado = empleado.IdEmpleado })" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Registrar Primera Tarifa
                    </a>
                </div>
            }
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/js/historialTarifa.js"></script>
}