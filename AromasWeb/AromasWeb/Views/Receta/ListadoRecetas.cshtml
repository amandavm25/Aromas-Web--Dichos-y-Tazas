@model List<AromasWeb.Abstracciones.ModeloUI.Receta>

@{
    ViewBag.Title = "Gestión de Recetas";
}

<!-- Hero Section -->
<section class="hero" style="min-height: 40vh; padding: 8rem 0 4rem;">
    <div class="hero-bg-overlay"></div>
    <div class="container hero-container" style="display: block;">
        <div class="hero-content" data-aos="fade-up" style="text-align: center;">
            <span class="hero-badge">
                <i class="fas fa-book-open"></i>
                Gestión de Recetas
            </span>
            <h1 class="hero-title" style="font-size: 3.5rem;">
                Libro de Recetas
            </h1>
            <p class="hero-subtitle">
                Administra las recetas de productos del menú
            </p>
        </div>
    </div>
</section>

<!-- Content Section -->
<section style="padding: 4rem 0; background: var(--cream);">
    <div class="container" style="max-width: 1600px;">

        <!-- Barra de búsqueda y botones -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 3rem; gap: 1rem; flex-wrap: wrap;">
            <form method="get" action="@Url.Action("ListadoRecetas", "Receta")" style="position: relative; flex: 1; min-width: 300px; display: flex; gap: 0.5rem;">
                <div style="position: relative; flex: 1;">
                    <i class="fas fa-search" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--teal); z-index: 1;"></i>
                    <input type="text"
                           name="buscar"
                           value="@ViewBag.Buscar"
                           placeholder="Buscar por nombre, categoría o ID..."
                           style="width: 100%; padding: 1rem 1rem 1rem 50px; border: 2px solid var(--cream); border-radius: 50px; font-size: 1rem; background: var(--white); transition: all 0.3s; box-shadow: var(--shadow-sm);">
                </div>
                <button type="submit" class="btn btn-primary" style="border-radius: 50px; padding: 0 2rem; white-space: nowrap;">
                    <span><i class="fas fa-search"></i> Buscar</span>
                </button>
            </form>

            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button onclick="ordenarPorRentabilidad()" class="btn btn-secondary" style="white-space: nowrap;">
                    <span><i class="fas fa-sort-amount-down"></i> Por Rentabilidad</span>
                </button>
                <a href="@Url.Action("CrearReceta", "Receta")" class="btn btn-primary btn-3d" style="white-space: nowrap;">
                    <span><i class="fas fa-plus"></i> Nueva Receta</span>
                </a>
            </div>
        </div>

        <!-- Información de búsqueda -->
        @if (!string.IsNullOrWhiteSpace(ViewBag.Buscar as string))
        {
            <div class="feature-card" style="margin-bottom: 2rem; text-align: left;" data-aos="fade-up">
                <p style="margin: 0; color: var(--dark-teal); display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-info-circle" style="color: var(--coral);"></i>
                    Mostrando resultados para <strong style="color: var(--coral);">"@ViewBag.Buscar"</strong>
                    - <strong>@(Model?.Count ?? 0)</strong> receta(s) encontrada(s)
                </p>
            </div>
        }

        <!-- Filtro por categoría -->
        <div style="margin-bottom: 3rem;" data-aos="fade-up">
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
                <span style="color: var(--dark-teal); font-weight: 600; margin-right: 0.5rem; font-family: var(--font-primary);">
                    <i class="fas fa-filter" style="color: var(--coral);"></i> Filtrar por categoría:
                </span>
                <a href="@Url.Action("ListadoRecetas", "Receta")"
                   class="btn @(ViewBag.Categoria == null && string.IsNullOrWhiteSpace(ViewBag.Buscar as string) ? "btn-primary" : "btn-secondary")"
                   style="border-radius: 50px; padding: 0.6rem 1.5rem; font-size: 0.9rem;">
                    <span><i class="fas fa-th"></i> Todas</span>
                </a>

                @if (ViewBag.TodasCategorias != null)
                {
                    @foreach (var categoria in (List<AromasWeb.Abstracciones.ModeloUI.CategoriaReceta>)ViewBag.TodasCategorias)
                    {
                        <a href="@Url.Action("ListadoRecetas", "Receta", new { categoria = categoria.IdCategoriaReceta })"
                           class="btn @(ViewBag.Categoria == categoria.IdCategoriaReceta ? "btn-primary" : "btn-secondary")"
                           style="border-radius: 50px; padding: 0.6rem 1.5rem; font-size: 0.9rem;">
                            <span>@categoria.Nombre</span>
                        </a>
                    }
                }
            </div>
        </div>

        <!-- Layout Principal: Tabla + Panel de Rentabilidad -->
        <div style="display: grid; grid-template-columns: 1fr 350px; gap: 2rem; align-items: start;" data-aos="fade-up">

            <!-- Tabla Principal -->
            <div style="background: var(--white); border-radius: 25px; box-shadow: var(--shadow-lg); overflow: hidden;">
                <div class="table-responsive">
                    <table id="laTablaDeRecetas" style="margin-bottom: 0; width: 100%; border-collapse: collapse;">
                        <thead style="background: linear-gradient(135deg, var(--teal) 0%, var(--dark-teal) 100%);">
                            <tr>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">#</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Nombre</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Categoría</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Porciones</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Costo Total</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Precio Venta</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Ganancia</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Margen</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none;">Disponible</th>
                                <th style="padding: 1.2rem; color: var(--white); font-weight: 600; border: none; text-align: center;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var recetasDemo = new List<dynamic>
                                                        {
                                                        new { Id = 1, Nombre = "Torta de Chocolate", Categoria = "Pasteles", Porciones = 12, CostoTotal = 15000m, CostoPorcion = 1250m, PrecioVenta = 28000m, GananciaNeta = 13000m, Margen = 46.43m, Disponible = true },
                                                        new { Id = 2, Nombre = "Café Capuchino", Categoria = "Bebidas Calientes", Porciones = 1, CostoTotal = 800m, CostoPorcion = 800m, PrecioVenta = 2500m, GananciaNeta = 1700m, Margen = 68.00m, Disponible = true },
                                                        new { Id = 3, Nombre = "Croissant de Mantequilla", Categoria = "Panadería", Porciones = 10, CostoTotal = 5500m, CostoPorcion = 550m, PrecioVenta = 12000m, GananciaNeta = 6500m, Margen = 54.17m, Disponible = true },
                                                        new { Id = 4, Nombre = "Galletas de Avena", Categoria = "Galletas", Porciones = 24, CostoTotal = 4000m, CostoPorcion = 166.67m, PrecioVenta = 9000m, GananciaNeta = 5000m, Margen = 55.56m, Disponible = true },
                                                        new { Id = 5, Nombre = "Muffin de Arándanos", Categoria = "Panadería", Porciones = 12, CostoTotal = 6000m, CostoPorcion = 500m, PrecioVenta = 13200m, GananciaNeta = 7200m, Margen = 54.55m, Disponible = false },
                                                        new { Id = 6, Nombre = "Brownie de Chocolate", Categoria = "Postres", Porciones = 16, CostoTotal = 8500m, CostoPorcion = 531.25m, PrecioVenta = 16000m, GananciaNeta = 7500m, Margen = 46.88m, Disponible = true },
                                                        new { Id = 7, Nombre = "Smoothie de Fresa", Categoria = "Bebidas Frías", Porciones = 2, CostoTotal = 1500m, CostoPorcion = 750m, PrecioVenta = 4000m, GananciaNeta = 2500m, Margen = 62.50m, Disponible = true },
                                                        new { Id = 8, Nombre = "Cheesecake de Vainilla", Categoria = "Pasteles", Porciones = 10, CostoTotal = 12000m, CostoPorcion = 1200m, PrecioVenta = 25000m, GananciaNeta = 13000m, Margen = 52.00m, Disponible = true }
                                                        };
                            }

                            @foreach (var receta in recetasDemo)
                            {
                                var colorMargen = receta.Margen >= 55 ? "#27ae60" : receta.Margen >= 45 ? "#f39c12" : "#e74c3c";
                                var margenBajo = receta.Margen < 45;
                                var rowStyle = margenBajo ? "background: rgba(231, 76, 60, 0.05); border-left: 4px solid #e74c3c;" : "";

                                <tr style="border-bottom: 1px solid rgba(32, 116, 118, 0.1); transition: all 0.3s; @rowStyle" data-margen="@receta.Margen">
                                    <td style="padding: 1.2rem; color: var(--dark-teal); font-weight: 600;">@receta.Id</td>
                                    <td style="padding: 1.2rem; color: var(--dark-teal); font-weight: 500;">
                                        @receta.Nombre
                                        @if (margenBajo)
                                        {
                                            <i class="fas fa-exclamation-circle" style="color: #e74c3c; margin-left: 0.5rem;" title="Margen bajo"></i>
                                        }
                                    </td>
                                    <td style="padding: 1.2rem; color: var(--black);">@receta.Categoria</td>
                                    <td style="padding: 1.2rem; color: var(--black); text-align: center;">@receta.Porciones</td>
                                    <td style="padding: 1.2rem; color: var(--coral); font-weight: 600;">₡@receta.CostoTotal.ToString("N2")</td>
                                    <td style="padding: 1.2rem; color: var(--green); font-weight: 600;">₡@receta.PrecioVenta.ToString("N2")</td>
                                    <td style="padding: 1.2rem; color: var(--teal); font-weight: 600;">₡@receta.GananciaNeta.ToString("N2")</td>
                                    <td style="padding: 1.2rem; font-weight: 600;">
                                        <span style="color: @colorMargen;">@receta.Margen.ToString("N2")%</span>
                                    </td>
                                    <td style="padding: 1.2rem;">
                                        @if (receta.Disponible)
                                        {
                                            <span style="background: #27ae60; color: var(--white); padding: 0.4rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block;">Sí</span>
                                        }
                                        else
                                        {
                                            <span style="background: #e74c3c; color: var(--white); padding: 0.4rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block;">No</span>
                                        }
                                    </td>
                                    <td style="padding: 1.2rem; text-align: center; white-space: nowrap;">
                                        <button type="button"
                                                class="btn btn-sm"
                                                onclick="window.location.href='@Url.Action("EditarReceta", "Receta", new { id = receta.Id })'"
                                                style="background: var(--teal); color: var(--white); border: none; margin: 0 0.25rem; cursor: pointer; padding: 0.5rem 0.8rem; border-radius: 8px;"
                                                title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button"
                                                class="btn btn-sm btn-detalles-receta"
                                                data-id="@receta.Id"
                                                data-nombre="@receta.Nombre"
                                                data-categoria="@receta.Categoria"
                                                data-porciones="@receta.Porciones"
                                                data-costo="@receta.CostoTotal.ToString("N2")"
                                                data-costorporcion="@receta.CostoPorcion.ToString("N2")"
                                                data-precio="@receta.PrecioVenta.ToString("N2")"
                                                data-ganancia="@receta.GananciaNeta.ToString("N2")"
                                                data-margen="@receta.Margen.ToString("N2")"
                                                data-disponible="@(receta.Disponible ? "Sí" : "No")"
                                                style="background: #3498db; color: var(--white); border: none; margin: 0 0.25rem; cursor: pointer; padding: 0.5rem 0.8rem; border-radius: 8px;"
                                                data-bs-toggle="modal"
                                                data-bs-target="#modalDetallesReceta"
                                                title="Ver detalles">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button"
                                                class="btn btn-sm btn-eliminar-receta"
                                                data-id="@receta.Id"
                                                data-nombre="@receta.Nombre"
                                                data-categoria="@receta.Categoria"
                                                data-porciones="@receta.Porciones"
                                                data-costo="@receta.CostoTotal.ToString("N2")"
                                                data-disponible="@(receta.Disponible ? "Disponible" : "No disponible")"
                                                style="background: #e74c3c; color: var(--white); border: none; margin: 0 0.25rem; cursor: pointer; padding: 0.5rem 0.8rem; border-radius: 8px;"
                                                data-bs-toggle="modal"
                                                data-bs-target="#modalEliminarReceta"
                                                title="Eliminar">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Footer de paginación -->
                <div style="padding: 1.5rem; background: var(--cream); display: flex; justify-content: space-between; align-items: center; border-top: 1px solid rgba(32, 116, 118, 0.1); flex-wrap: wrap; gap: 1rem;">
                    <div style="color: var(--dark-teal); font-size: 0.95rem;">
                        Mostrando <strong><span id="startRecord">1</span>-<span id="endRecord">8</span></strong> de <strong id="totalRecords">8</strong> recetas
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="btnAnterior" class="btn btn-secondary" onclick="paginaAnterior()" style="border-radius: 50px; padding: 0.8rem 2rem;">
                            &lt; Anterior
                        </button>
                        <button id="btnSiguiente" class="btn btn-primary" onclick="paginaSiguiente()" style="border-radius: 50px; padding: 0.8rem 2rem;">
                            Siguiente &gt;
                        </button>
                    </div>
                </div>
            </div>

            <!-- Panel de Rentabilidad (Derecha) -->
            <div style="position: sticky; top: 100px;">
                <!-- Top 3 Más Rentables -->
                <div style="background: var(--white); border-radius: 20px; box-shadow: var(--shadow-lg); overflow: hidden; margin-bottom: 1.5rem;">
                    <div style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-trophy" style="font-size: 1.5rem;"></i>
                            <div>
                                <h5 style="margin: 0; font-weight: 600; color: white; font-size: 1.1rem;">Top Rentables</h5>
                                <p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Mayor margen de ganancia</p>
                            </div>
                        </div>
                    </div>
                    <div id="topRentables" style="padding: 1rem; display: grid; gap: 0.7rem;">
                        <!-- Se llenará dinámicamente -->
                    </div>
                </div>

                <!-- Alertas de Margen Bajo -->
                <div style="background: var(--white); border-radius: 20px; box-shadow: var(--shadow-lg); overflow: hidden;">
                    <div style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-exclamation-circle" style="font-size: 1.5rem;"></i>
                            <div>
                                <h5 style="margin: 0; font-weight: 600; color: white; font-size: 1.1rem;">Margen Bajo</h5>
                                <p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Requieren revisión</p>
                            </div>
                        </div>
                    </div>
                    <div id="alertasMargenBajo" style="padding: 1rem; display: grid; gap: 0.7rem; max-height: 400px; overflow-y: auto;">
                        <!-- Se llenará dinámicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen Estadísticas (Abajo) -->
        <div style="margin-top: 3rem;" data-aos="fade-up">
            <div style="background: linear-gradient(135deg, var(--teal), var(--dark-teal)); padding: 2.5rem; border-radius: 25px; box-shadow: var(--shadow-lg);">
                <h5 style="margin: 0 0 2rem; color: white; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; font-size: 1.3rem;">
                    <i class="fas fa-chart-line"></i> Resumen de Recetas
                </h5>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div style="background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: 15px;">
                        <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 1rem;">
                            <i class="fas fa-book-open" style="font-size: 1.5rem; color: white;"></i>
                            <span style="font-size: 1rem; color: white; opacity: 0.9; font-weight: 500;">Total de Recetas</span>
                        </div>
                        <h4 style="margin: 0; font-size: 2rem; font-weight: 700; color: white;">8</h4>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: 15px;">
                        <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 1rem;">
                            <i class="fas fa-check-circle" style="font-size: 1.5rem; color: white;"></i>
                            <span style="font-size: 1rem; color: white; opacity: 0.9; font-weight: 500;">Disponibles</span>
                        </div>
                        <h4 id="totalDisponibles" style="margin: 0; font-size: 2rem; font-weight: 700; color: white;">7</h4>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: 15px;">
                        <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 1rem;">
                            <i class="fas fa-dollar-sign" style="font-size: 1.5rem; color: white;"></i>
                            <span style="font-size: 1rem; color: white; opacity: 0.9; font-weight: 500;">Margen Promedio</span>
                        </div>
                        <h4 id="margenPromedio" style="margin: 0; font-size: 2rem; font-weight: 700; color: white;">54.27%</h4>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); padding: 1.5rem; border-radius: 15px;">
                        <div style="display: flex; align-items: center; gap: 0.7rem; margin-bottom: 1rem;">
                            <i class="fas fa-coins" style="font-size: 1.5rem; color: white;"></i>
                            <span style="font-size: 1rem; color: white; opacity: 0.9; font-weight: 500;">Ganancia Total Potencial</span>
                        </div>
                        <h4 id="gananciaTotalPotencial" style="margin: 0; font-size: 2rem; font-weight: 700; color: white;">₡55,200</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<partial name="_ModalDetallesReceta" />
<partial name="_ModalEliminarReceta" />

@section Scripts {
    <script src="~/js/receta.js"></script>

    <script>
        // Datos de recetas
        const recetas = [
            { id: 1, nombre: "Torta de Chocolate", categoria: "Pasteles", porciones: 12, costoTotal: 15000, precioVenta: 28000, ganancia: 13000, margen: 46.43, disponible: true },
            { id: 2, nombre: "Café Capuchino", categoria: "Bebidas Calientes", porciones: 1, costoTotal: 800, precioVenta: 2500, ganancia: 1700, margen: 68.00, disponible: true },
            { id: 3, nombre: "Croissant de Mantequilla", categoria: "Panadería", porciones: 10, costoTotal: 5500, precioVenta: 12000, ganancia: 6500, margen: 54.17, disponible: true },
            { id: 4, nombre: "Galletas de Avena", categoria: "Galletas", porciones: 24, costoTotal: 4000, precioVenta: 9000, ganancia: 5000, margen: 55.56, disponible: true },
            { id: 5, nombre: "Muffin de Arándanos", categoria: "Panadería", porciones: 12, costoTotal: 6000, precioVenta: 13200, ganancia: 7200, margen: 54.55, disponible: false },
            { id: 6, nombre: "Brownie de Chocolate", categoria: "Postres", porciones: 16, costoTotal: 8500, precioVenta: 16000, ganancia: 7500, margen: 46.88, disponible: true },
            { id: 7, nombre: "Smoothie de Fresa", categoria: "Bebidas Frías", porciones: 2, costoTotal: 1500, precioVenta: 4000, ganancia: 2500, margen: 62.50, disponible: true },
            { id: 8, nombre: "Cheesecake de Vainilla", categoria: "Pasteles", porciones: 10, costoTotal: 12000, precioVenta: 25000, ganancia: 13000, margen: 52.00, disponible: true }
        ];

        // Función para ordenar por rentabilidad
        function ordenarPorRentabilidad() {
            const tbody = document.querySelector('#laTablaDeRecetas tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            rows.sort((a, b) => {
                const margenA = parseFloat(a.getAttribute('data-margen'));
                const margenB = parseFloat(b.getAttribute('data-margen'));
                return margenB - margenA;
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        // Calcular estadísticas y llenar paneles laterales
        document.addEventListener('DOMContentLoaded', function() {
            // Calcular estadísticas
            let totalDisponibles = 0;
            let sumaMargen = 0;
            let gananciaTotal = 0;
            let margenBajoCount = 0;

            recetas.forEach(receta => {
                if (receta.disponible) totalDisponibles++;
                sumaMargen += receta.margen;
                gananciaTotal += receta.ganancia;
            });

            const margenPromedio = (sumaMargen / recetas.length).toFixed(2);

            document.getElementById('totalDisponibles').textContent = totalDisponibles;
            document.getElementById('margenPromedio').textContent = margenPromedio + '%';
            document.getElementById('gananciaTotalPotencial').textContent = '₡' + gananciaTotal.toLocaleString('es-CR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            // Top 3 más rentables
            const topRentables = [...recetas].sort((a, b) => b.margen - a.margen).slice(0, 3);
            const topRentablesContainer = document.getElementById('topRentables');
            let topRentablesHTML = '';

            topRentables.forEach((receta, index) => {
                const colorMedalla = index === 0 ? '#FFD700' : index === 1 ? '#C0C0C0' : '#CD7F32';
                topRentablesHTML += `
                    <div style="background: var(--cream); padding: 1rem; border-radius: 10px; border-left: 3px solid ${colorMedalla};">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-medal" style="color: ${colorMedalla}; font-size: 1.2rem;"></i>
                            <strong style="color: var(--dark-teal); font-size: 0.95rem;">${receta.nombre}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--gray);">
                            <span>${receta.categoria}</span>
                            <span style="font-weight: 600; color: #27ae60; font-size: 1rem;">${receta.margen.toFixed(2)}%</span>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--gray);">
                            Ganancia: <strong style="color: var(--teal);">₡${receta.ganancia.toLocaleString('es-CR')}</strong>
                        </div>
                    </div>
                `;
            });

            topRentablesContainer.innerHTML = topRentablesHTML;

            // Alertas de margen bajo
            const alertasContainer = document.getElementById('alertasMargenBajo');
            let alertasHTML = '';

            recetas.forEach(receta => {
                if (receta.margen < 45) {
                    margenBajoCount++;
                    const porcentajeObjetivo = ((receta.margen / 50) * 100).toFixed(0);
                    const colorBarra = receta.margen < 30 ? '#e74c3c' : '#f39c12';

                    alertasHTML += `
                        <div style="background: var(--cream); padding: 1rem; border-radius: 10px; border-left: 3px solid #e74c3c;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong style="color: var(--dark-teal); font-size: 0.95rem;">${receta.nombre}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--gray); margin-bottom: 0.5rem;">
                                <span>Margen: ${receta.margen.toFixed(2)}%</span>
                                <span style="font-weight: 600; color: #e74c3c;">Objetivo: 50%</span>
                            </div>
                            <div style="background: #f5f5f5; height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${porcentajeObjetivo}%; height: 100%; background: ${colorBarra}; transition: width 0.3s;"></div>
                            </div>
                            <div style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--gray);">
                                Ganancia: <strong style="color: var(--coral);">₡${receta.ganancia.toLocaleString('es-CR')}</strong>
                            </div>
                        </div>
                    `;
                }
            });

            if (margenBajoCount === 0) {
                alertasContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--gray);"><i class="fas fa-check-circle" style="font-size: 2rem; color: #27ae60; margin-bottom: 0.5rem; display: block;"></i><p style="margin: 0;">Todas las recetas tienen buen margen</p></div>';
            } else {
                alertasContainer.innerHTML = alertasHTML;
            }

            // Inicializar modal de detalles
            const botonesDetalles = document.querySelectorAll('.btn-detalles-receta');
            botonesDetalles.forEach(boton => {
                boton.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const nombre = this.getAttribute('data-nombre');
                    const categoria = this.getAttribute('data-categoria');
                    const porciones = this.getAttribute('data-porciones');
                    const costo = this.getAttribute('data-costo');
                    const costoPorcion = this.getAttribute('data-costorporcion');
                    const precio = this.getAttribute('data-precio');
                    const ganancia = this.getAttribute('data-ganancia');
                    const margen = this.getAttribute('data-margen');
                    const disponible = this.getAttribute('data-disponible');

                    // Aquí iría la lógica para llenar el modal de detalles
                    console.log('Mostrando detalles de receta:', id);
                });
            });

            // Inicializar modal de eliminar
            const botonesEliminar = document.querySelectorAll('.btn-eliminar-receta');
            botonesEliminar.forEach(boton => {
                boton.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const nombre = this.getAttribute('data-nombre');
                    const categoria = this.getAttribute('data-categoria');
                    const porciones = this.getAttribute('data-porciones');
                    const costo = this.getAttribute('data-costo');
                    const disponible = this.getAttribute('data-disponible');

                    document.getElementById('eliminar-id-display-receta').textContent = id;
                    document.getElementById('eliminar-id-receta').value = id;
                    document.getElementById('eliminar-nombre-receta').textContent = nombre;
                    document.getElementById('eliminar-categoria-receta').textContent = categoria;
                    document.getElementById('eliminar-porciones-receta').textContent = porciones + ' porciones';
                    document.getElementById('eliminar-costo-receta').textContent = '₡' + costo;

                    const badge = document.getElementById('eliminar-disponibilidad-badge-receta');
                    if (disponible === 'Disponible') {
                        badge.textContent = 'Disponible';
                        badge.style.background = '#27ae60';
                    } else {
                        badge.textContent = 'No disponible';
                        badge.style.background = '#e74c3c';
                    }

                    const form = document.getElementById('formEliminarReceta');
                    form.action = '/Receta/EliminarReceta/' + id;
                });
            });
        });

        // Funciones de paginación (placeholders)
        function paginaAnterior() {
            console.log('Página anterior');
        }

        function paginaSiguiente() {
            console.log('Página siguiente');
        }
    </script>
}